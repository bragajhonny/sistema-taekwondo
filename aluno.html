<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Painel do Aluno</title>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }
    button {
      padding: 8px 14px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>Painel do Aluno</h2>
<button onclick="logout()">Sair</button>

<hr>

<h3>Meus Dados</h3>

<label>Nome</label>
<input id="nome">

<label>Data de Nascimento</label>
<input type="date" id="dataNascimento">

<label>Sexo</label>
<select id="sexo">
  <option value="">Selecione</option>
  <option>Masculino</option>
  <option>Feminino</option>
</select>

<label>Endereço</label>
<input id="endereco">

<label>Telefone</label>
<input id="telefone">

<label>Tipo Sanguíneo</label>
<input id="tipoSanguineo">

<label>Faixa</label>
<input id="faixa" disabled>

<label>RG</label>
<input id="rg" disabled>

<label>CPF</label>
<input id="cpf" disabled>

<label>Email</label>
<input id="email" disabled>

<button onclick="salvarDados()">Salvar Alterações</button>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDTcmFtCpgb-krAJ6OniJSXIXnkoxGzWF4",
    authDomain: "sistema-taekwondo-1.firebaseapp.com",
    projectId: "sistema-taekwondo-1",
    messagingSenderId: "635745416768",
    appId: "1:635745416768:web:58d23eca722878f047d1a5"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  let alunoUID = null;

  auth.onAuthStateChanged(user => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }

    alunoUID = user.uid;

    db.collection("alunos").doc(alunoUID).get().then(doc => {
      if (!doc.exists || doc.data().perfil !== "aluno") {
        alert("Acesso negado");
        window.location.href = "index.html";
        return;
      }

      preencherFormulario(doc.data());
    });
  });

  function preencherFormulario(data) {
    nome.value = data.nome || "";
    dataNascimento.value = data.dataNascimento || "";
    sexo.value = data.sexo || "";
    endereco.value = data.endereco || "";
    telefone.value = data.telefone || "";
    tipoSanguineo.value = data.tipoSanguineo || "";
    faixa.value = data.faixa || "";
    rg.value = data.rg || "";
    cpf.value = data.cpf || "";
    email.value = data.email || "";
  }

  function salvarDados() {
    db.collection("alunos").doc(alunoUID).update({
      nome: nome.value,
      dataNascimento: dataNascimento.value,
      sexo: sexo.value,
      endereco: endereco.value,
      telefone: telefone.value,
      tipoSanguineo: tipoSanguineo.value
    })
    .then(() => alert("Dados atualizados com sucesso!"))
    .catch(() => alert("Erro ao salvar dados"));
  }

  function logout() {
    auth.signOut().then(() => window.location.href = "index.html");
  }
</script>

</body>
</html>
