<!DOCTYPE HTML>
<html>
	<head>
		<title>Ficha do Aluno - CT Gerivaldo Silva</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

		<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  		<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  		<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
	</head>

	<body class="is-preload">
	<!-- Wrapper -->
	<div id="wrapper">
		<!-- Header -->
		<header id="header">
			<div class="inner">
				<!-- Logo -->
				<a href="index.html" class="logo">
					<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">CT Gerivaldo Silva</span>
				</a>
			</div>

			<!-- Nav -->
			<nav>
				<ul>
					<li><a href="#menu">Menu</a></li>
				</ul>
			</nav>
		</header>

		<!-- Menu -->
		<nav id="menu">
			<h2>Menu</h2>
			<ul>
				<li><a href="presenca.html">Presença</a></li>
				<li><a href="historico-aluno.html">Histórico de presença</a></li>
				<input type="button" value="Sair" class="primary" onclick="logout()" />
			</ul>
		</nav>

		<!-- Main -->
		<div id="main">
			<div class="inner">
				<h1>Ficha do Aluno</h1>
						
				<table>
					<tbody>
						<tr>
							<td>Nome</td>
							<td><input type="text" id="nome"></td>
						</tr>
						<tr>
							<td>Data de nascimento</td>
							<td><input type="text" id="dataNascimento" disabled></td>
						</tr>
						<tr>
							<td>Sexo</td>
							<td><input type="text" id="sexo" disabled></td>
						</tr>
						<tr>
							<td>Telefone</td>
							<td><input type="text" id="telefone" disabled></td>
						</tr>
						<tr>
							<td>Endereço</td>
							<td><input type="text" id="endereco"></td>
						</tr>
						<tr>
							<td>Tipo Sanguineo</td>
							<td><input type="text" id="tipoSanguineo" disabled></td>
						</tr>
						<tr>
							<td>Faixa</td>
							<td><input type="text" id="faixa" disabled></td>
						</tr>
						<tr>
							<td>RG</td>
							<td><input type="text" id="rg" disabled></td>
						</tr>
						<tr>
							<td>CPF</td>
							<td><input type="text" id="cpf" disabled></td>
						</tr>
						<tr>
							<td>E-mail</td>
							<td><input type="email" id="email" disabled></td>
						</tr>
					</tbody>
				</table>
				<ul class="actions">
					<li><input type="button" value="Voltar" class="primary" onclick="history.back()"/></li>
				</ul>
			</div>
		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

 <script>
  const firebaseConfig = {
    apiKey: "AIzaSyDTcmFtCpgb-krAJ6OniJSXIXnkoxGzWF4",
    authDomain: "sistema-taekwondo-1.firebaseapp.com",
    projectId: "sistema-taekwondo-1",
    messagingSenderId: "635745416768",
    appId: "1:635745416768:web:58d23eca722878f047d1a5"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  const params = new URLSearchParams(window.location.search);
  const alunoId = params.get("id");

  if (!alunoId) {
    alert("Aluno não informado");
    window.location.href = "professor.html";
  }

  auth.onAuthStateChanged(user => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }

    db.collection("alunos").doc(user.uid).get().then(doc => {
      if (!doc.exists || doc.data().perfil !== "professor") {
        alert("Acesso negado");
        window.location.href = "index.html";
        return;
      }

      carregarFicha();
    });
  });

  function carregarFicha() {
    db.collection("alunos").doc(alunoId).get()
      .then(doc => {
        if (!doc.exists) {
          alert("Aluno não encontrado");
          window.location.href = "professor.html";
          return;
        }

        const a = doc.data();

        document.getElementById("nome").value = a.nome || "";
        document.getElementById("dataNascimento").value = a.dataNascimento || "";
        document.getElementById("sexo").value = a.sexo || "";
        document.getElementById("telefone").value = a.telefone || "";
        document.getElementById("endereco").value = a.endereco || "";
        document.getElementById("tipoSanguineo").value = a.tipoSanguineo || "";
        document.getElementById("faixa").value = a.faixa || "";
        document.getElementById("rg").value = a.rg || "";
        document.getElementById("cpf").value = a.cpf || "";
        document.getElementById("email").value = a.email || "";
      })
      .catch(() => alert("Erro ao carregar ficha"));
  }

  function salvarDados() {
    const dados = {
      nome: document.getElementById("nome").value,
      dataNascimento: document.getElementById("dataNascimento").value,
      sexo: document.getElementById("sexo").value,
      telefone: document.getElementById("telefone").value,
      endereco: document.getElementById("endereco").value,
      tipoSanguineo: document.getElementById("tipoSanguineo").value
    };

    if (!confirm("Deseja salvar as alterações?")) return;

    db.collection("alunos").doc(alunoId).update(dados)
      .then(() => alert("Dados atualizados com sucesso"))
      .catch(() => alert("Erro ao salvar dados"));
  }

  function logout() {
    auth.signOut().then(() => window.location.href = "index.html");
  }
</script>

	</body>
</html>
