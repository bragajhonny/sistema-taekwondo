<!DOCTYPE HTML>
<html>
	<head>
		<title>CT Gerivaldo Silva</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>

	<body class="is-preload">
		<div id="wrapper">
			<header id="header">
				<div class="inner">
					<!-- Logo -->
					<a href="index.html" class="logo">
						<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">CT Gerivaldo Silva</span>
					</a>
				</div>
			</header>

			<!-- Footer -->
			<footer id="footer">
				<div class="inner">
					<section>
						<h2>Login</h2>
						<form onsubmit="return false;">
							<div class="fields">
								<div class="field half">
									<input type="email" id="email" placeholder="Digite seu e-mail" />
								</div>
								<div class="field half">
									<input type="password" id="senha" placeholder="Digite sua senha" />
								</div>
							</div>
							<ul class="actions">
								<li><input type="button" value="Login" class="primary" onclick="login()" /></li>
								<li>Não tem uma conta? Faça seu <a href="registro.html">cadastro aqui.</a></li>
							</ul>
						</form>
					</section>
				</div>
			</footer>
		</div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

		<script>
		const API_URL = 'https://script.google.com/macros/s/AKfycbzpsxS44FL5SZknvlV54nVWgkq3X88vC1nZ_Fwe2BiAo0ZFimrybnBXzgkSpN8yAxqjmA/exec';

		const usuarioLogado = localStorage.getItem('usuario');
		if (usuarioLogado) {
		  window.location.href = 'perfil.html';
		}
			
		function login() {
		  const email = document.getElementById('email').value.trim();
		  const senha = document.getElementById('senha').value.trim();
		
		  if (!email || !senha) {
			alert('Informe email e senha');
			return;
		  }
			
			const formData = new FormData();
			formData.append('acao', 'login');
			formData.append('email', email);
			formData.append('senha', senha);
			
			fetch(API_URL, {
				method: 'POST', body: formData
			})
			.then(res => res.json())
			.then(data => {
			if (data.status === 'sucesso') {
				localStorage.setItem('usuario', JSON.stringify(data.dados)); //Salva os dados do usuário logado
				window.location.href = 'perfil.html'; //TODOS vão para a mesma página
			} else {
				alert(data.msg);
			}
			})
			.catch(err => {
			console.error(err);
			alert('Erro ao conectar com o servidor');
			});
		}
		</script>
	</body>
</html>

