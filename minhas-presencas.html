<!DOCTYPE HTML>
<html>
	<head>
		<title>Minhas presenças - CT Gerivaldo Silva</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>

	<body class="is-preload">
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Header -->
			<header id="header">
				<div class="inner">
					<!-- Logo -->
					<a href="index.html" class="logo">
						<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">CT Gerivaldo Silva</span>
					</a>

					<!-- Nav -->
					<nav>
						<ul>
							<li><a href="#menu">Menu</a></li>
						</ul>
					</nav>
				</div>
			</header>

			<!-- MENU -->
			  <nav id="menu">
				<h2>Menu</h2>
				 <ul id="menuLinks"></ul>
				<input type="button" value="Sair" class="primary" onclick="logout()" />
			</nav>

      <div id="wrapper">
        <div id="main">
          <div class="inner">
      
            <h1>Minhas Presenças</h1>
      
            <table>
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Tipo de Treino</th>
                  <th>Avaliação</th>
                </tr>
              </thead>
              <tbody id="listaPresencas"></tbody>
            </table>
      
          </div>
        </div>
      </div>

<script>

const API_URL = 'https://script.google.com/macros/s/AKfycbxAAPLWqmKrbuyOT4KgaFlM0IFEPPNVkVlEFq8UZEXSZDw2gunsXSFqevwjt-oWIK2F-w/exec';
const usuario = JSON.parse(localStorage.getItem('usuario'));

/* =========================
			   INIT
			========================= */
			document.addEventListener('DOMContentLoaded', init);
			
			function init(){
				configurarMenu();
			}

document.addEventListener('DOMContentLoaded', () => {
  listarPresencas();
});

  function configurarMenu() {
				  const menu = document.getElementById('menuLinks');
				  menu.innerHTML = '';
				
				  menu.innerHTML += `<li><a href="perfil.html">Meu perfil</a></li>`;
				  menu.innerHTML += `<li><a href="editar-dados.html">Editar dados</a></li>`;
          menu.innerHTML += `<li><a href="minhas-presencas.html">Relatórios</a></li>`;
					menu.innerHTML += `<li><a href="historico-aluno.html">Histórico de presença</a></li>`;
				
				  if (usuario.tipo === 'professor') {
				    menu.innerHTML += `<li><a href="presenca.html">Presença</a></li>
				    <li><a href="professor.html">Painel do professor</a></li>
				    `;
				  }
				}
	
console.log("ID do usuário:", usuario.idUsuario);
console.log("Objeto usuario:", usuario);
	
function listarPresencas() {

  fetch(API_URL, {
    method: 'POST',
    body: new URLSearchParams({
      acao: 'listarMinhasPresencas',
      idUsuario: usuario.idUsuario
    })
  })
  .then(r => r.json())
  .then(res => {

    const tbody = document.getElementById('listaPresencas');
    tbody.innerHTML = '';

    if (!res.dados || res.dados.length === 0) {
      tbody.innerHTML = '<tr><td colspan="3">Nenhuma presença encontrada</td></tr>';
      return;
    }

    res.dados.forEach(item => {

      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${formatarData(item.data)}</td>
        <td>${item.tipoTreino}</td>
        <td>
          ${item.respondido 
            ? '✅ Respondido' 
            : `<button onclick="irParaAvaliacao('${item.data}')">Responder</button>`}
        </td>
      `;

      tbody.appendChild(tr);
    });

  });
}

function irParaAvaliacao(data) {
  window.location.href = `avaliacao.html?data=${data}`;
}

function formatarData(dataISO) {
  const data = new Date(dataISO);
  return data.toLocaleDateString('pt-BR');
}

  /* =========================
			   LOGOUT
			========================= */
			function logout() {
			  localStorage.removeItem('usuario');
			  window.location.href = 'index.html';
			}

</script>

</body>
</html>
