<!DOCTYPE HTML>
<html>
	<head>
		<title>Cadastro - CT Gerivaldo Silva</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>

	<body class="is-preload">
	<!-- Wrapper -->
	<div id="wrapper">
		<!-- Header -->
		<header id="header">
			<div class="inner">
				<!-- Logo -->
				<a href="index.html" class="logo">
					<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">CT Gerivaldo Silva</span>
				</a>
			</div>
		</header>

		<!-- Main -->
		<div id="main">
			<div class="inner">
				<h1>Cadastro</h1>
						
				<table>
					<tbody>
						<tr>
							<td>Nome</td>
							<td><input type="text" id="nome" placeholder="Nome completo"></td>
						</tr>
						<tr>
							<td>Data de nascimento</td>
							<td><input type="date" id="dataNascimento"></td>
						</tr>
						<tr>
							<td>Sexo</td>
							<td>
								<select id="sexo">
									<option value="">- Selecione -</option>
									<option value="Feminino">Feminino</option>
									<option value="Masculino">Masculino</option>
								</select>
							</td>
						</tr>
						<tr>
							<td>RG</td>
							<td><input type="text" id="rg" placeholder="RG"></td>
						</tr>
						<tr>
							<td>CPF</td>
							<td><input type="text" id="cpf" placeholder="CPF"></td>
						</tr>
						<tr>
							<td>Endereço</td>
							<td><input type="text" id="endereco" placeholder="Endereço"></td>
						</tr>
						<tr>
							<td>Telefone</td>
							<td><input type="text" id="telefone" placeholder="Telefone"></td>
						</tr>
						<tr>
							<td>Tipo Sanguineo</td>
							<td><input type="text" id="tipoSanguineo" placeholder="Tipo sanguineo"></td>
						</tr>
						<tr>
							<td>E-mail</td>
							<td><input type="email" id="email" placeholder="E-mail"></td>
						</tr>
						<tr>
							<td>Senha</td>
							<td><input type="password" id="senha" placeholder="Senha"></td>
						</tr>
					</tbody>
				</table>
				<ul class="actions">
					<li><input type="submit" value="Cadastrar" class="primary" onclick="cadastrar()" /></li>
					<li>Já tem uma conta? Faça seu <a href="index.html">login aqui.</a></li>
				</ul>
			</div>
		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbymmQ_M0X4GCH3W3Cp-zETzx0UbBIo523qwrFoEMtDLkyDpa6kSk5k5zvetApcBSZ6CHA/exec';

function cadastrar() {

  const btn = event.target;
  btn.disabled = true;

  const dados = {
    acao: 'cadastrarAluno',
    nome: document.getElementById('nome').value.trim(),
    dataNascimento: document.getElementById('dataNascimento').value,
    sexo: document.getElementById('sexo').value,
    rg: document.getElementById('rg').value.trim(),
    cpf: document.getElementById('cpf').value.trim(),
    endereco: document.getElementById('endereco').value.trim(),
    telefone: document.getElementById('telefone').value.trim(),
    tipoSanguineo: document.getElementById('tipoSanguineo').value.trim(),
    email: document.getElementById('email').value.trim(),
    senha: document.getElementById('senha').value.trim()
  };

  // Validação simples
  if (
    !dados.nome || !dados.dataNascimento || !dados.sexo ||
    !dados.rg || !dados.cpf || !dados.endereco ||
    !dados.telefone || !dados.tipoSanguineo ||
    !dados.email || !dados.senha
  ) {
    alert('Preencha todos os campos.');
    btn.disabled = false;
    return;
  }

  if (dados.senha.length < 6) {
    alert('A senha deve ter pelo menos 6 caracteres.');
    btn.disabled = false;
    return;
  }

  fetch(API_URL, {
    method: 'POST',
    body: new URLSearchParams(dados)
  })
  .then(r => r.json())
  .then(res => {

    btn.disabled = false;

    if (res.status !== 'sucesso') {
      alert(res.msg || 'Erro ao cadastrar');
      return;
    }

    localStorage.setItem('usuario', JSON.stringify({
      email: res.dados.email,
      tipo: res.dados.tipo
    }));

    window.location.href = 'aluno.html';
  })
  .catch(err => {
    console.error(err);
    alert('Erro de conexão');
    btn.disabled = false;
  });
}

</script>
	</body>
</html>
