<!DOCTYPE HTML>
<html>
	<head>
		<title>Painel do Aluno - CT Gerivaldo Silva</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

		<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  		<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  		<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
	</head>

	<body class="is-preload">
	<!-- Wrapper -->
	<div id="wrapper">
		<!-- Header -->
		<header id="header">
			<div class="inner">
				<!-- Logo -->
				<a href="index.html" class="logo">
					<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">CT Gerivaldo Silva</span>
				</a>
			</div>

			<!-- Nav -->
			<nav>
				<ul>
					<li><a href="#menu">Menu</a></li>
				</ul>
			</nav>
		</header>

		<!-- Menu -->
		<nav id="menu">
			<h2>Menu</h2>
			<ul>
				<li><a href="presenca.html">Presença</a></li>
				<li><a href="historico-aluno.html">Histórico de presença</a></li>
				<input type="button" value="Sair" class="primary" onclick="logout()" />
			</ul>
		</nav>

		<!-- Main -->
		<div id="main">
			<div class="inner">
				<h1>Painel do Aluno</h1>
						
				<table>
					<tbody>
						<tr>
							<td>Nome</td>
							<td><input type="text" id="nome" placeholder="Nome"></td>
						</tr>
						<tr>
							<td>Data de nascimento</td>
							<td><input type="text" id="dataNascimento"></td>
						</tr>
						<tr>
							<td>Sexo</td>
							<td><input type="text" id="sexo"></td>
						</tr>
						<tr>
							<td>Telefone</td>
							<td><input type="text" id="telefone"></td>
						</tr>
						<tr>
							<td>Endereço</td>
							<td><input type="text" id="endereco" placeholder="Endereço"></td>
						</tr>
						<tr>
							<td>Tipo Sanguineo</td>
							<td><input type="text" id="tipoSanguineo"></td>
						</tr>
						<tr>
							<td>RG</td>
							<td><input type="text" id="rg" placeholder="RG" ></td>
						</tr>
						<tr>
							<td>CPF</td>
							<td><input type="text" id="cpf" placeholder="CPF" ></td>
						</tr>
						<tr>
							<td>E-mail</td>
							<td><input type="text" id="email" disabled></td>
						</tr>
						<tr>
							<td>Faixa</td>
							<td><input type="text" id="faixa" disabled></td>
						</tr>
					</tbody>
				</table>
				<ul class="actions">
					<li><input type="submit" value="Salvar alterações" class="primary" onclick="salvarDados()" /></li>
				</ul>
			</div>
		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

 <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDTcmFtCpgb-krAJ6OniJSXIXnkoxGzWF4",
      authDomain: "sistema-taekwondo-1.firebaseapp.com",
      projectId: "sistema-taekwondo-1",
      messagingSenderId: "635745416768",
      appId: "1:635745416768:web:58d23eca722878f047d1a5"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();
    let alunoUID = null;

    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "index.html";
        return;
      }

      alunoUID = user.uid;

      db.collection("alunos").doc(alunoUID).get()
        .then(doc => {
          if (!doc.exists || doc.data().perfil !== "aluno") {
            alert("Acesso negado");
            window.location.href = "index.html";
            return;
          }

          preencherFormulario(doc.data());
        });
    });

    function preencherFormulario(data) {
      nome.value = data.nome || "";
      dataNascimento.value = data.dataNascimento || "";
      sexo.value = data.sexo || "";
      endereco.value = data.endereco || "";
      telefone.value = data.telefone || "";
      tipoSanguineo.value = data.tipoSanguineo || "";
      faixa.value = data.faixa || "";
      email.value = data.email || "";
    }

    function salvarDados() {
      db.collection("alunos").doc(alunoUID).update({
        nome: nome.value,
        dataNascimento: dataNascimento.value,
        sexo: sexo.value,
        endereco: endereco.value,
        telefone: telefone.value,
        tipoSanguineo: tipoSanguineo.value
      })
      .then(() => alert("Dados atualizados com sucesso"))
      .catch(() => alert("Erro ao salvar dados"));
    }

    function logout() {
      auth.signOut().then(() => {
        window.location.href = "index.html";
      });
    }
  </script>
	</body>
</html>
