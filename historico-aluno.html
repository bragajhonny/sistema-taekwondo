<!DOCTYPE HTML>
<html>
	<head>
		<title>Histórico de Presença - CT Gerivaldo Silva</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>

	<body class="is-preload">
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Header -->
			<header id="header">
				<div class="inner">
					<!-- Logo -->
					<a href="index.html" class="logo">
						<span class="symbol"><img src="images/logo.svg" alt="" /></span><span class="title">CT Gerivaldo Silva</span>
					</a>

					<!-- Nav -->
					<nav>
						<ul>
							<li><a href="#menu">Menu</a></li>
						</ul>
					</nav>
				</div>
			</header>

			<!-- Menu -->
			<nav id="menu">
				<h2>Menu</h2>
				<ul>
					<li><a href="professor.html">Painel do professor</a></li>
					<li><a href="presenca.html">Presença</a></li>
					<li><a href="historico-aluno.html">Histórico de presença</a></li>
					<input type="button" value="Sair" class="primary" onclick="logout()" />
				</ul>
			</nav>

			<!-- Main -->
			<div id="main">
				<div class="inner">
					<h1>Histórico de presença</h1>
					<select id="dataPresenca" onchange="carregarPresenca()"></select>
					<br />

					<h3>Alunos Presentes</h3>

            				<ul id="listaAlunos">
                				<li>Selecione uma data</li>
            				</ul>

            				<ul class="actions">
               					<li><input type="button" value="Voltar" class="primary" onclick="history.back()"/></li>
            				</ul>
				</div>
			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

  <script>
fetch(API_URL, {
  method: 'POST',
  body: new URLSearchParams({ acao: 'listarDatasPresenca' })
})
.then(r => r.json())
.then(res => {
  const select = document.getElementById('dataPresenca');
  select.innerHTML = `<option value="">Selecione a data</option>`;

  res.dados.forEach(data => {
    const opt = document.createElement('option');
    opt.value = data;
    opt.textContent = data;
    select.appendChild(opt);
  });
});

	  function carregarPresenca() {
  const data = document.getElementById('dataPresenca').value;
  const lista = document.getElementById('listaAlunos');

  lista.innerHTML = '';

  if (!data) {
    lista.innerHTML = '<li>Selecione uma data</li>';
    return;
  }

  fetch(API_URL, {
    method: 'POST',
    body: new URLSearchParams({
      acao: 'listarPresencaPorData',
      data: data
    })
  })
  .then(r => r.json())
  .then(res => {
    if (!res.dados.length) {
      lista.innerHTML = '<li>Nenhum aluno presente</li>';
      return;
    }

    res.dados.forEach(nome => {
      const li = document.createElement('li');
      li.textContent = nome;
      lista.appendChild(li);
    });
  })
  .catch(() => {
    lista.innerHTML = '<li>Erro ao carregar presença</li>';
  });
}


	function logout() {
  		localStorage.removeItem('usuario');
  		window.location.href = 'index.html';
	}

</script>

	</body>
</html>
