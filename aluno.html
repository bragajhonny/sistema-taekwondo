<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Aluno - CT Gerivaldo Silva</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="style.css">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="center-page">

  <div class="center-box card">

    <div class="header mb-20">
      <h1>Painel do Aluno</h1>
      <button class="btn btn-danger" onclick="logout()">Sair</button>
    </div>

    <h3 class="mb-20">Meus Dados</h3>

    <label>Nome</label>
    <input id="nome">

    <label>Data de nascimento</label>
    <input type="date" id="dataNascimento">

    <label>Sexo</label>
    <select id="sexo">
      <option value="">Selecione</option>
      <option>Masculino</option>
      <option>Feminino</option>
    </select>

    <label>Endereço</label>
    <input id="endereco">

    <label>Telefone</label>
    <input id="telefone">

    <label>Tipo sanguíneo</label>
    <input id="tipoSanguineo">

    <label>Faixa</label>
    <input id="faixa" disabled>

    <label>Email</label>
    <input id="email" disabled>

    <button class="btn btn-primary btn-lg mt-20" onclick="salvarDados()">
      Salvar alterações
    </button>

  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDTcmFtCpgb-krAJ6OniJSXIXnkoxGzWF4",
      authDomain: "sistema-taekwondo-1.firebaseapp.com",
      projectId: "sistema-taekwondo-1",
      messagingSenderId: "635745416768",
      appId: "1:635745416768:web:58d23eca722878f047d1a5"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();
    let alunoUID = null;

    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "index.html";
        return;
      }

      alunoUID = user.uid;

      db.collection("alunos").doc(alunoUID).get()
        .then(doc => {
          if (!doc.exists || doc.data().perfil !== "aluno") {
            alert("Acesso negado");
            window.location.href = "index.html";
            return;
          }

          preencherFormulario(doc.data());
        });
    });

    function preencherFormulario(data) {
      nome.value = data.nome || "";
      dataNascimento.value = data.dataNascimento || "";
      sexo.value = data.sexo || "";
      endereco.value = data.endereco || "";
      telefone.value = data.telefone || "";
      tipoSanguineo.value = data.tipoSanguineo || "";
      faixa.value = data.faixa || "";
      email.value = data.email || "";
    }

    function salvarDados() {
      db.collection("alunos").doc(alunoUID).update({
        nome: nome.value,
        dataNascimento: dataNascimento.value,
        sexo: sexo.value,
        endereco: endereco.value,
        telefone: telefone.value,
        tipoSanguineo: tipoSanguineo.value
      })
      .then(() => alert("Dados atualizados com sucesso"))
      .catch(() => alert("Erro ao salvar dados"));
    }

    function logout() {
      auth.signOut().then(() => {
        window.location.href = "index.html";
      });
    }
  </script>

</body>
</html>
